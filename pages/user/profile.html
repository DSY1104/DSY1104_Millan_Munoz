<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi Perfil - LevelUp</title>
    <link rel="stylesheet" href="../../assets/css/main.css" />
    <link rel="stylesheet" href="../../assets/css/pages/profile.css" />
  </head>
  <body>
    <!-- Navbar -->
    <div id="navbar-placeholder"></div>

    <main class="profile-main">
      <div class="profile-container">
        <!-- Header de perfil -->
        <section class="profile-header">
          <div class="profile-avatar-section">
            <div class="profile-avatar">
              <img
                id="profile-avatar-img"
                src="../../assets/image/icon/login.svg"
                alt="Avatar del usuario"
              />
              <button
                class="avatar-change-btn"
                id="change-avatar-btn"
                aria-label="Cambiar avatar"
              >
                📷
              </button>
            </div>
            <div class="profile-info">
              <h1 id="profile-display-name">Usuario Gamer</h1>
              <p class="profile-status" id="profile-status">
                Miembro desde 2024
              </p>
              <div class="profile-level-section">
                <p class="profile-level">
                  <span id="user-level-icon">🥉</span>
                  <span id="user-level-name">Bronze</span>
                  <span class="points-display"
                    >(<span id="user-points">0</span> puntos)</span
                  >
                  <button class="btn btn-secondary btn-small" id="redeem-points-btn">
                    Canjear Puntos
                  </button>
                </p>
                <div class="level-progress">
                  <div class="progress-bar-container">
                    <div class="progress-bar" id="level-progress-bar">
                      <div class="progress-fill" id="level-progress-fill"></div>
                    </div>
                    <div class="progress-text">
                      <span id="progress-points">0</span> /
                      <span id="next-level-points">1000</span>
                      <span class="next-level-name"
                        >hacia <span id="next-level-name">Silver</span></span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="profile-stats">
            <div class="stat-item">
              <span class="stat-value" id="total-purchases">0</span>
              <span class="stat-label">Compras</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="user-points-stat">0</span>
              <span class="stat-label">Puntos</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="wishlist-items">0</span>
              <span class="stat-label">Favoritos</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="reviews-count">0</span>
              <span class="stat-label">Reseñas</span>
            </div>
          </div>
        </section>

        <!-- Navegación de tabs -->
        <nav class="profile-tabs">
          <button class="tab-btn active" data-tab="personal">
            Información Personal
          </button>
          <button class="tab-btn" data-tab="preferences">Preferencias</button>
          <button class="tab-btn" data-tab="address">Dirección</button>
          <button class="tab-btn" data-tab="gaming">Perfil Gamer</button>
          <button class="tab-btn" data-tab="coupons">Mis Cupones</button>
          <button class="tab-btn" data-tab="security">Seguridad</button>
        </nav>

        <!-- Contenido de tabs -->
        <div class="profile-content">
          <!-- Tab: Información Personal -->
          <section class="tab-content active" id="personal-tab">
            <h2>Información Personal</h2>
            <form class="profile-form" id="personal-form">
              <div class="form-group">
                <label for="first-name">Nombre</label>
                <input type="text" id="first-name" name="firstName" required />
              </div>
              <div class="form-group">
                <label for="last-name">Apellido</label>
                <input type="text" id="last-name" name="lastName" required />
              </div>
              <div class="form-group">
                <label for="email">Correo Electrónico</label>
                <input type="email" id="email" name="email" required readonly />
                <small class="form-help">El correo no se puede modificar</small>
                <div
                  id="duoc-discount-badge"
                  class="discount-badge"
                  style="display: none"
                >
                  🎓 <strong>Descuento DUOC Activo:</strong> 20% de descuento de
                  por vida
                </div>
              </div>
              <div class="form-group">
                <label for="phone">Teléfono</label>
                <input type="tel" id="phone" name="phone" />
              </div>
              <div class="form-group">
                <label for="birthdate">Fecha de Nacimiento</label>
                <input type="date" id="birthdate" name="birthdate" />
              </div>
              <div class="form-group">
                <label for="bio">Biografía</label>
                <textarea
                  id="bio"
                  name="bio"
                  rows="4"
                  placeholder="Cuéntanos sobre ti..."
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                Guardar Cambios
              </button>
            </form>
          </section>

          <!-- Tab: Preferencias -->
          <section class="tab-content" id="preferences-tab">
            <h2>Preferencias de Gaming</h2>
            <form class="profile-form" id="preferences-form">
              <div class="form-group">
                <label>Categorías Favoritas</label>
                <div class="checkbox-group" id="favorite-categories">
                  <!-- Se cargan dinámicamente desde categories.json -->
                </div>
              </div>
              <div class="form-group">
                <label for="preferred-platform">Plataforma Preferida</label>
                <select id="preferred-platform" name="preferredPlatform">
                  <option value="">Selecciona una plataforma</option>
                  <option value="pc">PC</option>
                  <option value="playstation">PlayStation</option>
                  <option value="xbox">Xbox</option>
                  <option value="nintendo">Nintendo Switch</option>
                  <option value="mobile">Móvil</option>
                  <option value="retro">Retro/Clásicas</option>
                </select>
              </div>
              <div class="form-group">
                <label for="gaming-hours">Horas de juego por semana</label>
                <select id="gaming-hours" name="gamingHours">
                  <option value="">Selecciona</option>
                  <option value="1-5">1-5 horas</option>
                  <option value="6-15">6-15 horas</option>
                  <option value="16-30">16-30 horas</option>
                  <option value="30+">Más de 30 horas</option>
                </select>
              </div>
              <div class="form-group">
                <label>Notificaciones</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="notify-offers"
                      name="notifyOffers"
                    />
                    <span class="checkmark"></span>
                    Ofertas y descuentos
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="notify-new-products"
                      name="notifyNewProducts"
                    />
                    <span class="checkmark"></span>
                    Nuevos productos
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="notify-restocks"
                      name="notifyRestocks"
                    />
                    <span class="checkmark"></span>
                    Productos disponibles
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="notify-newsletter"
                      name="notifyNewsletter"
                    />
                    <span class="checkmark"></span>
                    Newsletter semanal
                  </label>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">
                Guardar Preferencias
              </button>
            </form>
          </section>

          <!-- Tab: Dirección -->
          <section class="tab-content" id="address-tab">
            <h2>Información de Dirección</h2>
            <form class="profile-form" id="address-form">
              <div class="form-group">
                <label for="address-line1">Dirección</label>
                <input
                  type="text"
                  id="address-line1"
                  name="addressLine1"
                  placeholder="Calle y número"
                />
              </div>
              <div class="form-group">
                <label for="address-line2"
                  >Dirección Adicional (opcional)</label
                >
                <input
                  type="text"
                  id="address-line2"
                  name="addressLine2"
                  placeholder="Departamento, oficina, etc."
                />
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="city">Ciudad</label>
                  <input type="text" id="city" name="city" />
                </div>
                <div class="form-group">
                  <label for="region">Región</label>
                  <select id="region" name="region">
                    <option value="">Selecciona región</option>
                    <option value="metropolitan">Metropolitana</option>
                    <option value="valparaiso">Valparaíso</option>
                    <option value="biobio">Biobío</option>
                    <option value="araucania">Araucanía</option>
                    <option value="los-lagos">Los Lagos</option>
                    <option value="antofagasta">Antofagasta</option>
                    <option value="coquimbo">Coquimbo</option>
                    <option value="ohiggins">O'Higgins</option>
                    <option value="maule">Maule</option>
                    <option value="los-rios">Los Ríos</option>
                    <option value="aysen">Aysén</option>
                    <option value="magallanes">Magallanes</option>
                    <option value="atacama">Atacama</option>
                    <option value="tarapaca">Tarapacá</option>
                    <option value="arica-parinacota">Arica y Parinacota</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="postal-code">Código Postal</label>
                  <input type="text" id="postal-code" name="postalCode" />
                </div>
                <div class="form-group">
                  <label for="country">País</label>
                  <select id="country" name="country">
                    <option value="chile">Chile</option>
                    <option value="argentina">Argentina</option>
                    <option value="peru">Perú</option>
                    <option value="other">Otro</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="delivery-notes">Instrucciones de Entrega</label>
                <textarea
                  id="delivery-notes"
                  name="deliveryNotes"
                  rows="3"
                  placeholder="Instrucciones especiales para el delivery..."
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                Guardar Dirección
              </button>
            </form>
          </section>

          <!-- Tab: Perfil Gamer -->
          <section class="tab-content" id="gaming-tab">
            <h2>Perfil de Gaming</h2>
            <form class="profile-form" id="gaming-form">
              <div class="form-group">
                <label for="gamer-tag">Gamer Tag</label>
                <input
                  type="text"
                  id="gamer-tag"
                  name="gamerTag"
                  placeholder="Tu nombre de gamer"
                />
              </div>
              <div class="form-group">
                <label for="favorite-genre">Género Favorito</label>
                <select id="favorite-genre" name="favoriteGenre">
                  <option value="">Selecciona un género</option>
                  <option value="fps">FPS</option>
                  <option value="rpg">RPG</option>
                  <option value="strategy">Estrategia</option>
                  <option value="moba">MOBA</option>
                  <option value="racing">Carreras</option>
                  <option value="sports">Deportes</option>
                  <option value="simulation">Simulación</option>
                  <option value="puzzle">Puzzle</option>
                  <option value="adventure">Aventura</option>
                  <option value="fighting">Lucha</option>
                </select>
              </div>
              <div class="form-group">
                <label for="skill-level">Nivel de Habilidad</label>
                <select id="skill-level" name="skillLevel">
                  <option value="beginner">Principiante</option>
                  <option value="intermediate">Intermedio</option>
                  <option value="advanced">Avanzado</option>
                  <option value="pro">Profesional</option>
                </select>
              </div>
              <div class="form-group">
                <label for="streaming-platforms"
                  >Plataformas de Streaming</label
                >
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      name="streamingPlatforms"
                      value="twitch"
                    />
                    <span class="checkmark"></span>
                    Twitch
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      name="streamingPlatforms"
                      value="youtube"
                    />
                    <span class="checkmark"></span>
                    YouTube Gaming
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      name="streamingPlatforms"
                      value="facebook"
                    />
                    <span class="checkmark"></span>
                    Facebook Gaming
                  </label>
                </div>
              </div>
              <div class="form-group">
                <label for="favorite-games">Juegos Favoritos</label>
                <textarea
                  id="favorite-games"
                  name="favoriteGames"
                  rows="3"
                  placeholder="Lista tus juegos favoritos..."
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                Guardar Perfil Gamer
              </button>
            </form>
          </section>

          <!-- Tab: Mis Cupones -->
          <section class="tab-content" id="coupons-tab">
            <h2>Mis Cupones</h2>
            
            <!-- Coupon Statistics -->
            <div class="coupon-stats">
              <div class="stat-card">
                <div class="stat-value" id="available-coupons-count">0</div>
                <div class="stat-label">Cupones Disponibles</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="total-coupon-value">$0</div>
                <div class="stat-label">Valor Total</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="used-coupons-count">0</div>
                <div class="stat-label">Cupones Usados</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="total-saved-amount">$0</div>
                <div class="stat-label">Total Ahorrado</div>
              </div>
            </div>

            <!-- Coupon Filter Tabs -->
            <div class="coupon-filter-tabs">
              <button class="filter-tab active" data-filter="available">
                Disponibles (<span id="available-count">0</span>)
              </button>
              <button class="filter-tab" data-filter="used">
                Usados (<span id="used-count">0</span>)
              </button>
              <button class="filter-tab" data-filter="expired">
                Expirados (<span id="expired-count">0</span>)
              </button>
            </div>

            <!-- Coupons Container -->
            <div class="coupons-container">
              <div class="coupon-filter-content active" id="available-coupons">
                <div class="coupons-grid" id="available-coupons-grid">
                  <div class="no-coupons-message">
                    <p>No tienes cupones disponibles.</p>
                    <p>¡Canjea tus puntos por cupones para empezar a ahorrar!</p>
                  </div>
                </div>
              </div>
              
              <div class="coupon-filter-content" id="used-coupons">
                <div class="coupons-grid" id="used-coupons-grid">
                  <div class="no-coupons-message">
                    <p>No has usado cupones aún.</p>
                  </div>
                </div>
              </div>
              
              <div class="coupon-filter-content" id="expired-coupons">
                <div class="coupons-grid" id="expired-coupons-grid">
                  <div class="no-coupons-message">
                    <p>No tienes cupones expirados.</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Tab: Seguridad -->
          <section class="tab-content" id="security-tab">
            <h2>Configuración de Seguridad</h2>
            <form class="profile-form" id="security-form">
              <div class="security-section">
                <h3>Cambiar Contraseña</h3>
                <div class="form-group">
                  <label for="current-password">Contraseña Actual</label>
                  <input
                    type="password"
                    id="current-password"
                    name="currentPassword"
                  />
                </div>
                <div class="form-group">
                  <label for="new-password">Nueva Contraseña</label>
                  <input type="password" id="new-password" name="newPassword" />
                </div>
                <div class="form-group">
                  <label for="confirm-password"
                    >Confirmar Nueva Contraseña</label
                  >
                  <input
                    type="password"
                    id="confirm-password"
                    name="confirmPassword"
                  />
                </div>
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="change-password-btn"
                >
                  Cambiar Contraseña
                </button>
              </div>

              <div class="security-section">
                <h3>Sesiones Activas</h3>
                <div class="sessions-list" id="active-sessions">
                  <div class="session-item">
                    <div class="session-info">
                      <strong>Navegador actual</strong>
                      <p>Chrome en Windows - Última actividad: Ahora</p>
                    </div>
                    <button class="btn btn-text">Actual</button>
                  </div>
                </div>
              </div>

              <div class="security-section">
                <h3>Configuración de Privacidad</h3>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="profile-public"
                      name="profilePublic"
                    />
                    <span class="checkmark"></span>
                    Perfil público
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="show-activity"
                      name="showActivity"
                    />
                    <span class="checkmark"></span>
                    Mostrar actividad de compras
                  </label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="allow-friend-requests"
                      name="allowFriendRequests"
                    />
                    <span class="checkmark"></span>
                    Permitir solicitudes de amistad
                  </label>
                </div>
              </div>

              <div class="danger-zone">
                <h3>Zona de Peligro</h3>
                <p>
                  Una vez que elimines tu cuenta, no hay vuelta atrás. Por
                  favor, asegúrate.
                </p>
                <button
                  type="button"
                  class="btn btn-danger"
                  id="delete-account-btn"
                >
                  Eliminar Cuenta
                </button>
              </div>
            </form>
          </section>
        </div>
      </div>
    </main>

    <!-- Modal de confirmación para eliminar cuenta -->
    <div class="modal" id="delete-account-modal">
      <div class="modal-content">
        <h3>¿Estás seguro?</h3>
        <p>Esta acción no se puede deshacer. Se eliminarán permanentemente:</p>
        <ul>
          <li>Tu información personal</li>
          <li>Historial de compras</li>
          <li>Preferencias guardadas</li>
          <li>Reseñas y comentarios</li>
        </ul>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="cancel-delete">Cancelar</button>
          <button class="btn btn-danger" id="confirm-delete">
            Eliminar Definitivamente
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de canje de puntos -->
    <div class="modal" id="redeem-points-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Canjear Puntos por Cupones</h3>
          <button class="modal-close" id="close-redeem-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="current-points-display">
            <p>Puntos disponibles: <strong><span id="modal-current-points">0</span> puntos</strong></p>
          </div>
          
          <div class="coupon-tiers">
            <h4>Selecciona un cupón para canjear:</h4>
            <div class="tiers-grid" id="coupon-tiers-grid">
              <!-- Coupon tiers will be populated here -->
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="cancel-redeem">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Modal de confirmación de canje -->
    <div class="modal" id="confirm-redeem-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Confirmar Canje</h3>
          <button class="modal-close" id="close-confirm-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="redeem-confirmation">
            <div class="coupon-preview" id="coupon-preview">
              <!-- Coupon preview will be populated here -->
            </div>
            <div class="redeem-details">
              <p>¿Estás seguro de que quieres canjear <strong><span id="confirm-points-cost">0</span> puntos</strong> por este cupón?</p>
              <p>Te quedarán <strong><span id="remaining-points">0</span> puntos</strong> después del canje.</p>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="cancel-confirm-redeem">Cancelar</button>
          <button class="btn btn-primary" id="confirm-redeem-btn">Confirmar Canje</button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../../assets/js/components/navbar-include.js"></script>
    <script type="module" src="../../assets/js/components/login.js"></script>
    <script type="module" src="../../assets/js/components/register.js"></script>
    <script type="module" src="../../assets/js/pages/profile.js"></script>
  </body>
</html>
